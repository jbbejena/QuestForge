<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Camp - WWII Text Adventure</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-campground"></i> Field Camp</h1>
            <p class="subtitle">Rest and prepare for the next mission</p>
        </div>

        <div class="content">
            <div class="camp-status">
                <div class="status-grid">
                    <div class="status-item">
                        <i class="fas fa-heart"></i>
                        <span>Health: {{ player.health }}/{{ player.max_health or 100 }}</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-smile"></i>
                        <span>Morale: {{ player.morale }}/100</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-users"></i>
                        <span>Squad: {{ squad|length }} members</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-medal"></i>
                        <span>Missions: {{ missions_completed }}</span>
                    </div>
                </div>
            </div>

            <div class="camp-description">
                <p>Your squad has set up a temporary camp in a secure location. The area is quiet, giving you a chance to rest and prepare for the challenges ahead.</p>
                <p>Choose how you want to spend your time:</p>
            </div>

            <div class="camp-options">
                <div class="camp-option">
                    <button class="camp-btn rest" onclick="performCampAction('rest')">
                        <i class="fas fa-bed"></i>
                        <h3>Rest</h3>
                        <p>Sleep and recover health and morale</p>
                    </button>
                </div>

                <div class="camp-option">
                    <button class="camp-btn heal" onclick="performCampAction('heal_squad')">
                        <i class="fas fa-medkit"></i>
                        <h3>Heal Squad</h3>
                        <p>Tend to wounded squad members</p>
                    </button>
                </div>

                <div class="camp-option">
                    <button class="camp-btn resupply" onclick="performCampAction('resupply')">
                        <i class="fas fa-box"></i>
                        <h3>Resupply</h3>
                        <p>Search for ammunition and supplies</p>
                    </button>
                </div>

                <div class="camp-option">
                    <button class="camp-btn train" onclick="performCampAction('train')">
                        <i class="fas fa-dumbbell"></i>
                        <h3>Train</h3>
                        <p>Improve combat effectiveness</p>
                    </button>
                </div>
            </div>

            <div class="resource-display">
                <h3>Current Resources</h3>
                <div class="resources-grid">
                    <div class="resource-item">
                        <i class="fas fa-bullets"></i>
                        <span>Ammo: {{ resources.ammo }}</span>
                    </div>
                    <div class="resource-item">
                        <i class="fas fa-bomb"></i>
                        <span>Grenades: {{ resources.grenade }}</span>
                    </div>
                    <div class="resource-item">
                        <i class="fas fa-first-aid"></i>
                        <span>Medkits: {{ resources.medkit }}</span>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <a href="/missions" class="btn btn-primary">
                    <i class="fas fa-map"></i> Continue to Next Mission
                </a>
                <a href="/base" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Return to Base
                </a>
            </div>
        </div>
    </div>

    <div class="camp-modal" id="campResultModal" style="display: none;">
        <div class="camp-content">
            <h2 id="campResultTitle">Camp Action</h2>
            <p id="campResultMessage"></p>
            <div class="rest-progress" id="restProgress" style="display: none;">
                <div class="rest-fill" id="restFill"></div>
            </div>
            <button onclick="closeCampModal()" class="btn btn-primary">Continue</button>
        </div>
    </div>

    <script>
        function performCampAction(action) {
            // Show loading
            const btn = event.target.closest('.camp-btn');
            btn.disabled = true;
            btn.innerHTML += '<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span>';
            
            fetch('/camp_action', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `action=${action}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showCampResult(action, data.message);
                    
                    // Update display after a delay
                    setTimeout(() => {
                        location.reload();
                    }, 3000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                btn.disabled = false;
            });
        }
        
        function showCampResult(action, message) {
            const modal = document.getElementById('campResultModal');
            const title = document.getElementById('campResultTitle');
            const msg = document.getElementById('campResultMessage');
            const progress = document.getElementById('restProgress');
            const fill = document.getElementById('restFill');
            
            // Set title based on action
            const titles = {
                'rest': 'Resting...',
                'heal_squad': 'Medical Treatment',
                'resupply': 'Searching for Supplies',
                'train': 'Training Session'
            };
            
            title.textContent = titles[action] || 'Camp Action';
            msg.textContent = message;
            
            // Show progress bar for rest action
            if (action === 'rest') {
                progress.style.display = 'block';
                setTimeout(() => {
                    fill.style.width = '100%';
                }, 100);
            } else {
                progress.style.display = 'none';
            }
            
            modal.style.display = 'block';
        }
        
        function closeCampModal() {
            document.getElementById('campResultModal').style.display = 'none';
        }
    </script>
</body>
</html>